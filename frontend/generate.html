<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="ุชูููุฏ ุงูุฌุฏูู ุงูุฏุฑุงุณู - ุฅูุดุงุก ุฌุฏูู ุฏุฑุงุณู ูุชูุงูู">
  <title>ุชูููุฏ ุงูุฌุฏูู - ูููุฏ ุงูุฌุฏูู ุงูุฏุฑุงุณู</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <link rel="stylesheet" href="css/styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <!-- Preload critical resources -->
  <link rel="preload" href="js/shared.js" as="script">
  <link rel="preload" href="js/generate.js" as="script">
</head>
<body>
  <div class="loading-overlay hidden" id="globalLoader">
    <div class="loading-spinner"></div>
    <div class="loading-text">ุฌุงุฑ ุงูุชุญููู...</div>
  </div>

  <nav class="main-nav animate__animated animate__fadeIn" aria-label="ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ">
    <ul>
      <li><a href="index.html">ุงูุฑุฆูุณูุฉ</a></li>
      <li><a href="settings.html">ุฅุนุฏุงุฏุงุช ุงููููุฉ</a></li>
      <li><a href="departments.html">ุฅุฏุงุฑุฉ ุงูุฃูุณุงู</a></li>
      <li><a href="add-teachers.html">ุฅุถุงูุฉ ูุฏุฑุณูู</a></li>
      <li><a href="students.html">ุฅุฏุงุฑุฉ ุงูุทูุงุจ</a></li>
      <li><a href="courses.html">ุฅุฏุงุฑุฉ ุงูููุงุฏ</a></li>
      <li><a href="rooms.html">ุฅุฏุงุฑุฉ ุงูุฃูุงูู</a></li>
      <li><a href="teachers.html">ุฅุฏุงุฑุฉ ุงููุฏุฑุณูู</a></li>
      <li><a href="generate.html" class="active" aria-current="page">ุชูููุฏ ุงูุฌุฏูู</a></li>
      <li><a href="schedule.html">ุนุฑุถ ุงูุฌุฏูู</a></li>
    </ul>
  </nav>

  <main class="container animate__animated animate__fadeIn">
    <header>
      <h1 class="animate__animated animate__bounceIn">ุชูููุฏ ุงูุฌุฏูู ุงูุฏุฑุงุณู</h1>
      <p class="subtitle">ุฅูุดุงุก ุฌุฏูู ุฏุฑุงุณู ูุชูุงูู ุจูุงุกู ุนูู ุงูุจูุงูุงุช ุงููุฏุฎูุฉ</p>
    </header>

    <section class="section animate-slide" aria-labelledby="generation-options-heading">
      <h2 id="generation-options-heading">ุฎูุงุฑุงุช ุงูุชูููุฏ</h2>
      
      <div class="generation-filters">
        <div class="input-group">
          <label for="deptFilter">ููุชุฑุฉ ุญุณุจ ุงููุณู:</label>
          <select id="deptFilter" aria-describedby="deptFilterHelp">
            <option value="">ุฌููุน ุงูุฃูุณุงู</option>
            <!-- Will be populated by JavaScript -->
          </select>
          <p id="deptFilterHelp" class="input-hint">ุชูููุฏ ุฌุฏูู ููุณู ูุนูู ููุท</p>
        </div>
      </div>

      <div class="generation-options">
        <div class="option-card" id="quickGenCard">
          <div class="option-icon">โก</div>
          <h3>ุชูููุฏ ุณุฑูุน</h3>
          <p>ูููุฏ ุฌุฏูู ูุงุญุฏ ุจุณุฑุนุฉ ุจุงุณุชุฎุฏุงู ุงูุฎูุงุฑุฒููุฉ ุงูุฃุณุงุณูุฉ</p>
          <div class="option-details">
            <ul>
              <li>ููุช ุชูููุฐ: 1-5 ุซูุงูู</li>
              <li>ุฌูุฏุฉ ูุชูุณุทุฉ</li>
              <li>ููุงุณุจ ููุงุฎุชุจุงุฑ</li>
            </ul>
          </div>
          <button id="generateBtn" class="btn-secondary">
            <span class="icon">โก</span>
            <span class="text">ุชูููุฏ ุณุฑูุน</span>
          </button>
        </div>
        
        <div class="option-card" id="preciseGenCard">
          <div class="option-icon">๐</div>
          <h3>ุชูููุฏ ุฏููู</h3>
          <p>ูููุฏ ุฃูุถู ุฌุฏูู ุจุนุฏุฉ ูุญุงููุงุช ุจุงุณุชุฎุฏุงู ุฎูุงุฑุฒููุฉ ูุชุทูุฑุฉ</p>
          <div class="option-details">
            <ul>
              <li>ููุช ุชูููุฐ: 10-60 ุซุงููุฉ</li>
              <li>ุฌูุฏุฉ ุนุงููุฉ</li>
              <li>ุชุญุณูู ุชููุงุฆู</li>
            </ul>
          </div>
          <button id="generateBestBtn" class="btn-secondary">
            <span class="icon">๐</span>
            <span class="text">ุชูููุฏ ุฏููู</span>
          </button>
        </div>
      </div>

      <div class="advanced-options">
        <h3>ุฎูุงุฑุงุช ูุชูุฏูุฉ</h3>
        <div class="advanced-options-grid">
          <label class="option-checkbox">
            <input type="checkbox" id="optimizeCheckbox" checked>
            <span class="checkmark"></span>
            <span>ุชุญุณูู ุชูุฒูุน ุงููุงุนุงุช ูุงููุฏุฑุณูู</span>
          </label>
          
          <label class="option-checkbox">
            <input type="checkbox" id="balanceLoadCheckbox" checked>
            <span class="checkmark"></span>
            <span>ููุงุฒูุฉ ุงูุนุจุก ุจูู ุงููุฏุฑุณูู</span>
          </label>
          
          <label class="option-checkbox">
            <input type="checkbox" id="minimizeGapsCheckbox">
            <span class="checkmark"></span>
            <span>ุชูููู ุงููุฑุงุบุงุช ุจูู ุงููุญุงุถุฑุงุช</span>
          </label>
          
          <div class="input-group">
            <label for="maxGenerationTime">ุงูุญุฏ ุงูุฃูุตู ููููุช (ุซุงููุฉ):</label>
            <input type="number" id="maxGenerationTime" min="5" max="300" value="30">
          </div>
        </div>
      </div>
    </section>

    <section class="section animate-slide" aria-labelledby="generation-status-heading">
      <h2 id="generation-status-heading">ุญุงูุฉ ุงูุชูููุฏ</h2>
      
      <div id="generationProgress" class="progress-container hidden">
        <div class="progress-header">
          <span id="progressStatus">ุฌุงุฑู ุงูุชูููุฏ...</span>
          <span id="progressPercent">0%</span>
        </div>
        <div class="progress-bar">
          <div id="progressBar" class="progress-bar-fill" style="width: 0%"></div>
        </div>
        <div class="progress-details">
          <div class="progress-metric">
            <span class="metric-label">ุนุฏุฏ ุงููุญุงููุงุช:</span>
            <span id="attemptsCount" class="metric-value">0</span>
          </div>
          <div class="progress-metric">
            <span class="metric-label">ุฃูุถู ูุชูุฌุฉ:</span>
            <span id="bestScore" class="metric-value">0%</span>
          </div>
          <div class="progress-metric">
            <span class="metric-label">ุงูููุช ุงููููุถู:</span>
            <span id="elapsedTime" class="metric-value">0 ุซุงููุฉ</span>
          </div>
        </div>
      </div>

      <div id="generationResults" class="results-container hidden">
        <h3>ูุชุงุฆุฌ ุงูุชูููุฏ</h3>
        <div class="results-grid">
          <div class="result-card success">
            <span class="result-icon">โ</span>
            <span class="result-label">ุงูุญุตุต ุงููุจุฑูุฌุฉ:</span>
            <span id="scheduledLessons" class="result-value">0</span>
          </div>
          <div class="result-card warning">
            <span class="result-icon">!</span>
            <span class="result-label">ุงูุญุตุต ุบูุฑ ุงููุจุฑูุฌุฉ:</span>
            <span id="unscheduledLessons" class="result-value">0</span>
          </div>
          <div class="result-card info">
            <span class="result-icon">โฑ</span>
            <span class="result-label">ูุฏุฉ ุงูุชูููุฏ:</span>
            <span id="generationTime" class="result-value">0 ุซุงููุฉ</span>
          </div>
          <div class="result-card primary">
            <span class="result-icon">โญ</span>
            <span class="result-label">ุฌูุฏุฉ ุงูุฌุฏูู:</span>
            <span id="scheduleQuality" class="result-value">0%</span>
          </div>
        </div>
        
        <div class="results-actions">
          <button id="viewScheduleBtn" class="btn-primary">
            <span class="icon">๐</span>
            <span class="text">ุนุฑุถ ุงูุฌุฏูู</span>
          </button>
          <button id="tryAgainBtn" class="btn-secondary">
            <span class="icon">๐</span>
            <span class="text">ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู</span>
          </button>
          <button id="exportResultsBtn" class="btn-secondary">
            <span class="icon">๐ค</span>
            <span class="text">ุชุตุฏูุฑ ุงููุชุงุฆุฌ</span>
          </button>
        </div>
      </div>

      <div id="preGenerationCheck" class="pre-check-container">
        <h3>ูุญุต ุงูุฌุงูุฒูุฉ</h3>
        <ul id="readinessChecks">
          <li data-check="teachers" class="check-item">
            <span class="check-icon">โณ</span>
            <span class="check-text">ุงูุชุญูู ูู ูุฌูุฏ ูุฏุฑุณูู</span>
          </li>
          <li data-check="rooms" class="check-item">
            <span class="check-icon">โณ</span>
            <span class="check-text">ุงูุชุญูู ูู ูุฌูุฏ ูุงุนุงุช</span>
          </li>
          <li data-check="availability" class="check-item">
            <span class="check-icon">โณ</span>
            <span class="check-text">ุงูุชุญูู ูู ุชูุงูุฑ ุงููุฏุฑุณูู</span>
          </li>
          <li data-check="labs" class="check-item">
            <span class="check-icon">โณ</span>
            <span class="check-text">ุงูุชุญูู ูู ุงููุนุงูู ููููุงุฏ ุงูุชู ุชุญุชุงุฌูุง</span>
          </li>
        </ul>
      </div>
    </section>
  </main>

  <footer class="main-footer">
    <p>ูุธุงู ุชูููุฏ ุงูุฌุฏุงูู ุงูุฏุฑุงุณูุฉ &copy; <span id="currentYear"></span></p>
  </footer>

  <script src="js/shared.js" defer></script>
  <script src="js/generate.js" defer></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Set current year in footer
      document.getElementById('currentYear').textContent = new Date().getFullYear();
      
      // Function to check readiness
      function checkReadiness() {
        // Ensure SharedData is available
        if (!window.SharedData) {
          console.error('SharedData not available');
          return;
        }

        // Get data with fallbacks
        const teachers = SharedData.teachers || [];
        const rooms = SharedData.rooms || [];
        const departments = SharedData.departments || [];

        // Check teachers
        const teachersCheck = document.querySelector('[data-check="teachers"]');
        if (teachers.length > 0) {
          teachersCheck.innerHTML = `
            <span class="check-icon">โ</span>
            <span class="check-text">ุชู ุงูุนุซูุฑ ุนูู ${teachers.length} ูุฏุฑุณ</span>
          `;
          teachersCheck.classList.add('success');
        } else {
          teachersCheck.innerHTML = `
            <span class="check-icon">โ</span>
            <span class="check-text">ูุง ููุฌุฏ ูุฏุฑุณูู ูุณุฌููู</span>
          `;
          teachersCheck.classList.add('error');
        }
        
        // Check rooms
        const roomsCheck = document.querySelector('[data-check="rooms"]');
        if (rooms.length > 0) {
          roomsCheck.innerHTML = `
            <span class="check-icon">โ</span>
            <span class="check-text">ุชู ุงูุนุซูุฑ ุนูู ${rooms.length} ูุงุนุฉ</span>
          `;
          roomsCheck.classList.add('success');
        } else {
          roomsCheck.innerHTML = `
            <span class="check-icon">โ</span>
            <span class="check-text">ูุง ููุฌุฏ ูุงุนุงุช ูุณุฌูุฉ</span>
          `;
          roomsCheck.classList.add('error');
        }
        
        // Check availability
        const availabilityCheck = document.querySelector('[data-check="availability"]');
        const teachersWithAvailability = teachers.filter(teacher => {
          return teacher.availability && Object.values(teacher.availability).some(hours => hours.length > 0);
        }).length;
        
        if (teachersWithAvailability > 0) {
          availabilityCheck.innerHTML = `
            <span class="check-icon">${teachersWithAvailability === teachers.length ? 'โ' : '!'}</span>
            <span class="check-text">${teachersWithAvailability}/${teachers.length} ูุฏุฑุณ ูุฏููู ุชููุฑ</span>
          `;
          availabilityCheck.classList.add(teachersWithAvailability === teachers.length ? 'success' : 'warning');
        } else {
          availabilityCheck.innerHTML = `
            <span class="check-icon">โ</span>
            <span class="check-text">ูุง ููุฌุฏ ูุฏุฑุณูู ูุฏููู ุฃููุงุช ูุชุงุญุฉ</span>
          `;
          availabilityCheck.classList.add('error');
        }
        
        // Check labs
        const labsCheck = document.querySelector('[data-check="labs"]');
        const teachersNeedLabs = teachers.filter(t => t.requiresLab).length;
        const hasLabs = rooms.some(r => r.type && r.type !== 'room');
        
        if (teachersNeedLabs === 0) {
          labsCheck.innerHTML = `
            <span class="check-icon">โ</span>
            <span class="check-text">ูุง ุชูุฌุฏ ููุงุฏ ุชุญุชุงุฌ ูุนุงูู</span>
          `;
          labsCheck.classList.add('success');
        } else if (hasLabs) {
          const labCount = rooms.filter(r => r.type && r.type !== 'room').length;
          labsCheck.innerHTML = `
            <span class="check-icon">${labCount >= teachersNeedLabs ? 'โ' : '!'}</span>
            <span class="check-text">${labCount} ูุนูู ูุชุงุญ ูู ${teachersNeedLabs} ูุงุฏุฉ</span>
          `;
          labsCheck.classList.add(labCount >= teachersNeedLabs ? 'success' : 'warning');
        } else {
          labsCheck.innerHTML = `
            <span class="check-icon">โ</span>
            <span class="check-text">${teachersNeedLabs} ูุงุฏุฉ ุชุญุชุงุฌ ูุนุงูู ูููู ูุง ุชูุฌุฏ ูุนุงูู ูุณุฌูุฉ</span>
          `;
          labsCheck.classList.add('error');
        }
      }
      
      // Function to populate department filter
      function populateDeptFilter() {
        const deptFilter = document.getElementById('deptFilter');
        if (!deptFilter) return;
        
        // Use fallback if departments not available
        const departments = SharedData.departments || [];
        
        deptFilter.innerHTML = `
          <option value="">ุฌููุน ุงูุฃูุณุงู</option>
          ${departments.map(dept => `
            <option value="${dept.id}">${dept.name} (${dept.code})</option>
          `).join('')}
        `;
      }
      
      // Initialize after SharedData is ready
      if (window.SharedData) {
        checkReadiness();
        populateDeptFilter();
      } else {
        document.addEventListener('SharedDataReady', () => {
          checkReadiness();
          populateDeptFilter();
        });
      }
    });
  </script>

  <!-- Dark mode toggle button (keep this) -->
  <button class="theme-toggle" id="themeToggle" aria-label="ุชุจุฏูู ุงููุถุน ุงููููู">
    <i>๐</i>
  </button>
</body>
</html>